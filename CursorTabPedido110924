--USO DO CURSOR EM UMA 'FUNCTION'

CREATE FUNCTION PROC_PEDIDO()
RETURNS @TAB_PEDIDO TABLE(
    ORDER_ID VARCHAR(11),
    PURCH_DATE DATE,
    PAYS_DATE DATE,
    QTD_PURCH INT,
    CURRENCY VARCHAR(11))
AS 
BEGIN
    DECLARE @COD_PED INT
    
    DECLARE CURS_PED CURSOR FOR SELECT COD_PED FROM PEDIDO
    OPEN CURS_PED
    FETCH NEXT FROM CURS_PED INTO @COD_PED

    WHILE @@FETCH_STATUS = 0
    BEGIN
         INSERT INTO @TAB_PEDIDO
         SELECT ORDER_ID, PURCH_DATE, PAYS_DATE, QTD_PURCH
         FROM PEDIDO
         WHERE COD_PED = @COD_PED

         FETCH NEXT FROM CURS_PED INTO @COD_PED
    
    END
    CLOSE CURS_PED
    DEALLOCATE CURS_PED

    RETURN
END
